/** xj.focus(区分聚焦模式) | V0.4.0 | Apache Licence 2.0 | 2018-2022 © XJ.Chen | https://github.com/xjZone/xj.focus/ */
!function(a,b){"function"!=typeof define||void 0===define.amd&&void 0===define.cmd?"undefined"!=typeof module&&"object"==typeof exports?module.exports=b():(a=a||self,a.xj||(a.xj={}),a.xj.focus=b()):define(b)}(this,function(){"use strict";var b,c,d,e,f,g,h,i,j,k,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return!function(){var a=window.Element.prototype;"function"!=typeof a.matches&&(a.matches=a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return Boolean(c[d])}),"function"!=typeof a.closest&&(a.closest=function(a){for(var b=this;b&&1===b.nodeType;){if(b.matches(a))return b;b=b.parentNode}return null})}(),b=function(a,b){var c,d;return a.classList?a.classList.add(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],0===d.length?a.setAttribute("class",b):-1===d.indexOf(b)&&a.setAttribute("class",d.join(" ")+" "+b),void 0)},c=function(a,b){var c,d;return a.classList?a.classList.remove(b):(c=a.getAttribute("class"),d=c?c.split(/\s+/):[],c="",-1!==d.indexOf(b)&&(d.forEach(function(a){a!==b&&(c+=a+" ")}),a.setAttribute("class",c.trim())),void 0)},d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global,e=function(){},f="0.4.0",g="focus",h={classTarget:document.documentElement,existClass:"xj-focus-exist",ontabClass:"xj-focus-ontab",ontapClass:"xj-focus-ontap",otherClass:"xj-focus-other",outlineClass:"xj-focus-outline",shadowClass:"xj-focus-shadow",insetClass:"xj-focus-inset",ontabSelector:["textarea",'input:not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="checkbox"]):not([type="range"]):not([type="color"])'],ontapSelector:/MSIE|Trident|EDGE/i.test(navigator.userAgent)||/Apple/i.test(navigator.vendor)?[]:["audio","video"],otherSelector:["svg a","map area"],modifiableTag:"ontab"},i={debug:!1,time:250,style:"auto",inset:!1,ontabAlways:!1,ontapAlways:!1,otherAlways:!1,ontabCallback:e,ontapCallback:e,otherCallback:e,initializedFocus:"ontab",visibilityFocus:"ontab",automaticFocus:"ontab",dispatchFocus:"other",elementFocus:"ontab",inherit:!0},void 0===d.xj&&(d.xj={}),void 0===d.xj.focusReturn&&(d.xj.focusReturn={}),void 0!==d.xj.focusReturn[f]?d.xj.focusReturn[f]:(void 0===d.xj.focusConfig&&(d.xj.focusConfig={}),void 0===d.xj.focusOption&&(d.xj.focusOption={}),void 0!==d.xj.focusConfig[f]&&Object.keys(d.xj.focusConfig[f]).forEach(function(a){h[a]=d.xj.focusConfig[f][a]}),void 0!==d.xj.focusOption[f]&&Object.keys(d.xj.focusOption[f]).forEach(function(a){i[a]=d.xj.focusOption[f][a]}),j=d,k=j.document,k.documentElement,k.body,n=/Apple/i.test(navigator.vendor),o=/Firefox/i.test(navigator.userAgent),p=function(a,c,d){"auto"===c&&(c=n===!0||o===!0&&d===!0?"outline":"shadow"),b(a,"shadow"===c?h.shadowClass:h.outlineClass)},q={version:f,ontab:!1,ontap:!1,other:!1,ontabSet:function(a,d){var f;d?f||(f=a.xj_focus=B(a,d)):f=a.xj_focus,(f.ontabCallback===e||f.ontabCallback(a)!==!1)&&(q.ontab=!0,q.ontap=!1,q.other=!1,f.inset&&b(a,h.insetClass),p(a,f.style,f.inset),b(a,h.ontabClass),c(a,h.ontapClass),c(a,h.otherClass))},ontapSet:function(a,d){var f;d?f||(f=a.xj_focus=B(a,d)):f=a.xj_focus,(f.ontabCallback===e||f.ontabCallback(a)!==!1)&&(q.ontab=!1,q.ontap=!0,q.other=!1,f.inset&&b(a,h.insetClass),p(a,f.style,f.inset),c(a,h.ontabClass),b(a,h.ontapClass),c(a,h.otherClass))},otherSet:function(a,d){var f;d?f||(f=a.xj_focus=B(a,d)):f=a.xj_focus,(f.ontabCallback===e||f.ontabCallback(a)!==!1)&&(q.ontab=!1,q.ontap=!1,q.other=!0,f.inset&&b(a,h.insetClass),p(a,f.style,f.inset),c(a,h.ontabClass),c(a,h.ontapClass),b(a,h.otherClass))}},r=null,s=function(a){for(var b=!1,c=r;b===!1&&null!==c&&void 0!==c&&1===c.nodeType;)/^label$/i.test(c.nodeName)===!0||c===a?b=!0:c=c.parentElement;return b},t=/Firefox/i.test(navigator.userAgent)===!0?"MozUserModify":"webkitUserModify",u=function(a,b){return j.getComputedStyle(a,b?b:null)},v=function(a){return/^(input|textarea)$/i.test(a.nodeName)===!0?!1:a.isContentEditable===!0||void 0===k.documentMode&&/write/i.test(u(a)[t])===!0?!0:!1},function(){var a=null,b=!1;try{a=k.createElement("input"),a.type="color",a.value="!",b="color"===a.type&&"!"!==a.value}catch(c){}b===!1&&h.ontabSelector.forEach(function(a,b){-1!==a.indexOf(':not([type="color"])')&&(h.ontabSelector[b]=a.replace(':not([type="color"])',""))})}(),w=!1,x=function(a,b){switch(w=!1,b){case"ontab":y(a,!0);break;case"ontap":z(a,!0);break;case"other":A(a,!0)}},function(){var a,b,c;void 0!==k.documentMode&&(a=/^(input|textarea|select|button|audio|video|area|svg|a|iframe|embed|object)$/i,b=null,c=void 0,x=function(d,e){if(w=!1,b=d.target,c=b.getAttribute("tabIndex"),a.test(b.nodeName)===!0||b.isContentEditable===!0||void 0!==c&&null!==c&&""!==c&&c>=0)switch(e){case"ontab":y(d,!0);break;case"ontap":z(d,!0);break;case"other":A(d,!0)}})}(),y=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return y(a,!1);if("ontap"===h.modifiableTag)return z(a,!1);if("other"===h.modifiableTag)return A(a,!1)}for(d=0,e=h.ontapSelector.length;e>d;d++)if(a.target.matches(h.ontapSelector[d])===!0){z(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherSelector.length;e>d;d++)if(a.target.matches(h.otherSelector[d])===!0){A(a,!1),c=!0;break}if(c===!0)return}q.ontabSet(a.target)},z=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return y(a,!1);if("ontap"===h.modifiableTag)return z(a,!1);if("other"===h.modifiableTag)return A(a,!1)}for(d=0,e=h.ontabSelector.length;e>d;d++)if(a.target.matches(h.ontabSelector[d])===!0){y(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.otherSelector.length;e>d;d++)if(a.target.matches(h.otherSelector[d])===!0){A(a,!1),c=!0;break}if(c===!0)return}q.ontapSet(a.target)},A=function(a,b){var c=!1,d=0,e=0;if(b===!0){if(v(a.target)===!0){if("ontab"===h.modifiableTag)return y(a,!1);if("ontap"===h.modifiableTag)return z(a,!1);if("other"===h.modifiableTag)return A(a,!1)}for(d=0,e=h.ontabSelector.length;e>d;d++)if(a.target.matches(h.ontabSelector[d])===!0){y(a,!1),c=!0;break}if(c===!0)return;for(d=0,e=h.ontapSelector.length;e>d;d++)if(a.target.matches(h.ontapSelector[d])===!0){z(a,!1),c=!0;break}if(c===!0)return}q.otherSet(a.target)},B=function(a,b){for(var c=[],d={},e=a,f="";e;)f=e.getAttribute("xj-focus"),""!==f&&null!==f&&void 0!==f&&c.unshift(eval("("+f+")")),e=e.hasAttribute("xj-focus")===!1||void 0===c[0].inherit||c[0].inherit===!0?e.parentElement:null;return null!==b&&void 0!==b&&c.push(b),c.unshift(i),c.forEach(function(a){Object.keys(a).forEach(function(b){d[b]=a[b]})}),d},j.addEventListener("focus",function(a){var b,c;if(1===a.target.nodeType)return b=a.target.xj_focus=B(a.target),b.ontabAlways===!0?y(a,!1):b.ontapAlways===!0?z(a,!1):b.otherAlways===!0?A(a,!1):a.isTrusted===!1?(x(a,b.dispatchFocus),void 0):(c=Date.now(),c-C<=b.time?(x(a,b.initializedFocus),void 0):c-D<=b.time?(x(a,b.visibilityFocus),void 0):w===!0?(x(a,b.automaticFocus),void 0):c-E<=b.time?(y(a,!0),void 0):c-F<=b.time&&s(a.target)===!0?(z(a,!0),void 0):(x(a,b.elementFocus),void 0))},!0),j.addEventListener("blur",function(a){var b,d,e,f,g,i,l;a.isTrusted===!0&&a.target===j&&(w=!0),q.other=!1,q.ontab=!1,q.ontap=!1,b=a.target.xj_focus,b&&b.debug||(delete a.target.xj_focus,d=k.querySelectorAll("."+h.ontabClass),e=k.querySelectorAll("."+h.ontapClass),f=k.querySelectorAll("."+h.otherClass),g=k.querySelectorAll("."+h.insetClass),i=k.querySelectorAll("."+h.shadowClass),l=k.querySelectorAll("."+h.outlineClass),d.length>0&&Array.prototype.forEach.call(d,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.ontabClass)}),e.length>0&&Array.prototype.forEach.call(e,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.ontapClass)}),f.length>0&&Array.prototype.forEach.call(f,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.otherClass)}),g.length>0&&Array.prototype.forEach.call(g,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.insetClass)}),i.length>0&&Array.prototype.forEach.call(i,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.shadowClass)}),l.length>0&&Array.prototype.forEach.call(l,function(a){(void 0===a.xj_focus||a.xj_focus.debug!==!0)&&c(a,h.outlineClass)}))},!0),C=0,k.addEventListener("DOMContentLoaded",function(a){a.isTrusted!==!1&&(C=Date.now())},!0),D=0,k.addEventListener("visibilitychange",function(a){a.isTrusted!==!1&&(D=Date.now())},!0),E=0,k.addEventListener("keydown",function(a){-1!==[9,37,38,39,40].indexOf(a.keyCode)&&a.isTrusted!==!1&&(E=Date.now())},!0),F=0,["mousedown","touchstart"].forEach(function(a){k.addEventListener(a,function(a){a.isTrusted!==!1&&(r=a.target,F=Date.now())},!0)}),null!==h.classTarget&&""!==h.existClass&&h.classTarget.classList.add(h.existClass),d.xj[g+"Return"][f]=q)});
