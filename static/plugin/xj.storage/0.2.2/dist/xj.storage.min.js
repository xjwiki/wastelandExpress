/** xj.storage(本地存储操作) | V0.2.2 | Apache Licence 2.0 | 2019-2022 © XJ.Chen | https://github.com/xjZone/xj.storage/ */
!function(a,b){"function"!=typeof define||void 0===define.amd&&void 0===define.cmd?"undefined"!=typeof module&&"object"==typeof exports?module.exports=b():(a=a||self,a.xj||(a.xj={}),a.xj.storage=b()):define(b)}(this,function(){"use strict";var g,h,k,l,m,n,o,p,q,r,s,t,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global,c="0.2.2",e={consoleError:!0,undefined2null:!0,dispatchOriginal:!0},f={};return void 0===a.xj&&(a.xj={}),void 0===a.xj.storageReturn&&(a.xj.storageReturn={}),void 0!==a.xj.storageReturn[c]?a.xj.storageReturn[c]:(void 0===a.xj.storageConfig&&(a.xj.storageConfig={}),void 0===a.xj.storageOption&&(a.xj.storageOption={}),void 0!==a.xj.storageConfig[c]&&Object.keys(a.xj.storageConfig[c]).forEach(function(b){e[b]=a.xj.storageConfig[c][b]}),void 0!==a.xj.storageOption[c]&&Object.keys(a.xj.storageOption[c]).forEach(function(b){f[b]=a.xj.storageOption[c][b]}),g=a,h=g.document,h.documentElement,h.body,k=g.localStorage,l=g.sessionStorage,m={listener:[]},n={listener:[]},o=["ls","ss"],p=/xjStorage_t-?\d+r\d{13,}/,q="xjStorage_t"+Date.now()+"r"+(Math.random()+""+Math.random()).replace(/0\./g,"").slice(0,13),r=function(a,b,c,d){if(e.dispatchOriginal!==!1){var f=h.createEvent("StorageEvent");f.initStorageEvent("storage",!1,!1,a,b,c,location.href,d),g.dispatchEvent(f)}},s=function(a,b){var c="ls"===a?m:n;c.error=b,e.consoleError===!0&&void 0!==g.console&&console.error(b)},o.forEach(function(a){var b="ls"===a?m:n,c="ls"===a?k:l;try{b.error=null,b.support=!0,c.setItem("xj-storage-test-key","1"),c.removeItem("xj-storage-test-key")}catch(d){b.support=!1,s(a,d)}}),o.forEach(function(a){var b=m,c=k;"ss"===a&&(b=n,c=l),b.length=function(){var d=0;if(b.support===!1)return d;try{d=c.length}catch(e){s(a,e)}return d},b.key=function(d){var e=null;if(b.support===!1)return e;try{e=c.key(d)}catch(f){s(a,f)}return e},b.get=function(d,e){var f=null;if(1===arguments.length&&(e=null),0===arguments.length||b.support===!1)return e;try{f=c.getItem(d),null===f?f=e:p.test(f)===!0&&(f=JSON.parse(f).data)}catch(g){f=e,s(a,g)}return f},b.set=function(d,f){var g,h,i,j;if(b.support!==!1&&2===arguments.length){g=null,h=null,i=null,j="";try{h=c.getItem(d),e.undefined2null!==!0||"symbol"!=typeof f&&"function"!=typeof f&&void 0!==f||(f=null),null===h&&p.test(h)===!1?(j=null===h?"create":"set",i={id:q,act:j,data:f},i=JSON.stringify(i),c.setItem(d,i),r(d,h,i,c)):(g=JSON.parse(h),JSON.stringify(f)!==JSON.stringify(g.data)&&(i={id:q,act:"set",data:f},i=JSON.stringify(i),c.setItem(d,i),r(d,h,i,c)))}catch(k){s(a,k)}}},b.remove=function(d){if(b.support!==!1&&0!==arguments.length){var e=null,f=null;try{e=c.getItem(d),null!==e&&(f={id:q,act:"remove",data:null},f=JSON.stringify(f),c.setItem(d,f),r(d,e,f,c),c.removeItem(d))}catch(g){s(a,g)}}},b.clear=function(){if(b.support!==!1){var d=null;try{0!==c.length&&(d={id:q,act:"clear",data:null},d=JSON.stringify(d),c.setItem("xj-storage-clear-key",d),r("xj-storage-clear-key",null,d,c),c.clear())}catch(e){s(a,e)}}},b.byte=function(){var d,e,f,g,h;if(b.support===!1)return d;d=0,e=0,f=0,g="",h="";try{for(e=0,f=c.length;f>e;e++)g=c.key(e),h=c.getItem(g),d+=g.length+(h?h.length:0)}catch(i){s(a,i)}return d},b.on=function(a,c){b.support!==!1&&2===arguments.length&&b.listener.push({key:a,callback:c})},b.off=function(a,c){var d,e;b.support!==!1&&0!==arguments.length&&(d=arguments.length,e=[],b.listener.forEach(function(b){1===d&&b.key!==a?e.push(b):2===d&&(b.key===a&&b.callback===c)==!1&&e.push(b)}),b.listener=e)}}),g.addEventListener("storage",function(a){var j,b=k,c=m,d=null,e="",f=null,g="",h=!1;if(b!==a.storageArea&&(b=l,c=n),c.support!==!1&&"xj-storage-test-key"!==a.key&&null!==a.key&&""!==a.key&&null!==a.newValue&&""!==a.newValue){try{if(p.test(a.newValue)!==!0)throw"ignore this event";f=JSON.parse(a.newValue),g=f.data,p.test(a.oldValue)===!0?(d=JSON.parse(a.oldValue),e=d.data):e=a.oldValue}catch(i){h=!0}h!==!0&&(a.isTrusted!==!0||f.id!==q)&&(j={url:a.url,key:a.key,oldValue:e,newValue:g,storageArea:a.storageArea},"clear"===f.act?(j.key=null,j.oldValue=null,j.newValue=null):"create"===f.act?j.oldValue=null:"remove"===f.act&&(j.newValue=null),c.listener.forEach(function(a){null===j.key?a.callback(j):j.key===a.key&&a.callback(j)}))}},!1),t={version:c,localStorage:m,sessionStorage:n},a.xj.storageReturn[c]=t)});
